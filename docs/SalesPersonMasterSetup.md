# 担当者マスタ設定ガイド

## 概要

担当者マスタ機能は、音声文字起こし時の担当者名の表記ゆれや漢字の誤変換を防ぐための機能です。スプレッドシートで担当者名を一元管理し、LLMが正しい担当者名を使用できるようにします。

## 機能の特徴

### 1. 動的データ読み込み
- スプレッドシートから担当者名を動的に読み込み
- 新しい担当者の追加時はコード変更不要
- 1時間のキャッシュで高速処理

### 2. エイリアス自動生成
- 姓のみ（例：「高野」→「高野 仁」）
- ひらがな表記（例：「たかの」→「高野 仁」）
- カタカナ表記（例：「タカノ」→「高野 仁」）
- ローマ字表記（例：「TAKANO」→「高野 仁」）
- 敬称付き（例：「高野さん」→「高野 仁」）

### 3. 表記ゆれの自動修正
- 漢字の誤変換を防止（例：「高野」が「鷹野」になるのを防ぐ）
- 姓のみの呼称をフルネームに自動変換
- 一貫性のある担当者名表記を実現

## 設定方法

### 1. スプレッドシートの準備

1. クライアントマスタと同じスプレッドシートに「担当者マスタ」シートを作成
2. 以下の構造でデータを入力：

| A列（extension_number） | B列（sales_employee_name） |
|------------------------|---------------------------|
| 940                    | 高野 仁                    |
| 939                    | 本間 隼                    |
| 938                    | 下山 裕司                  |
| 937                    | 枡田 明良                  |
| 936                    | 中山 勇樹                  |
| 935                    | 家永 麻里絵                |
| 933                    | 齋藤 茜                    |
| ...                    | ...                       |

### 2. スクリプトプロパティの確認

既存の`CLIENT_MASTER_SPREADSHEET_ID`を使用するため、追加設定は不要です。

## 使用方法

### 1. 基本的な使用

```javascript
// 担当者名リストを取得
var salesPersons = SalesPersonMasterLoader.getSalesPersons();
// 例: ["高野 仁", "本間 隼", "下山 裕司", ...]

// 担当者名を正規化
var normalizedName = SalesPersonMasterLoader.normalizeSalesPersonName("たかの");
// 結果: "高野 仁"

// LLM用プロンプトを取得
var prompt = SalesPersonMasterLoader.getSalesPersonListPrompt();
```

### 2. TranscriptionServiceでの自動適用

TranscriptionServiceでは、以下の処理が自動的に行われます：

1. **話者分離時**: GPT-4o-miniに正しい担当者名リストを提供
2. **文字起こし後**: 担当者名を自動的に正規化
3. **結果出力時**: 一貫性のある担当者名表記

## エイリアス設定のカスタマイズ

### デフォルトのエイリアス生成ルール

1. フルネーム（例：「高野 仁」）
2. 姓のみ（例：「高野」）
3. 全角・半角スペースの両対応

### 特殊なエイリアスの追加

`SalesPersonMasterLoader.js`の`generatePersonAliases`関数内の`specialAliases`オブジェクトに追加：

```javascript
var specialAliases = {
  '高野 仁': ['高野', 'たかの', 'タカノ', 'TAKANO', '高野さん'],
  '枡田 明良': ['枡田', '桝田', 'ますだ', 'マスダ', 'MASUDA', '枡田さん', '桝田さん'],
  // 新しい担当者のエイリアスを追加
  '新担当者名': ['エイリアス1', 'エイリアス2', ...]
};
```

## トラブルシューティング

### 1. 担当者名が正しく表示されない

- スプレッドシートの「担当者マスタ」シートを確認
- B列に正しい担当者名が入力されているか確認
- キャッシュをクリア: `SalesPersonMasterLoader.clearCache()`

### 2. 新しい担当者が反映されない

- キャッシュの有効期限（1時間）を待つか、手動でクリア
- スプレッドシートの権限を確認

### 3. エラーが発生する場合

- スクリプトプロパティの`CLIENT_MASTER_SPREADSHEET_ID`を確認
- スプレッドシートへのアクセス権限を確認
- ログを確認: `Logger.log()`の出力をチェック

## メンテナンス

### 担当者の追加

1. スプレッドシートの「担当者マスタ」シートに新しい行を追加
2. A列に内線番号、B列に正式な氏名を入力
3. 保存後、1時間以内に自動反映（即時反映したい場合はキャッシュクリア）

### 担当者の削除

1. スプレッドシートから該当行を削除
2. キャッシュクリア後に反映

### 担当者名の変更

1. スプレッドシートのB列を編集
2. キャッシュクリア後に反映

## 注意事項

- 担当者名は必ず「姓 名」の形式で入力（スペースは半角推奨）
- 同姓の担当者がいる場合は、フルネームでの識別が必要
- 特殊な読み方がある場合は、`specialAliases`に追加を推奨 